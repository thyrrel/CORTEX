# db_setup_action.py (ADICIONAR NA RAIZ)

import os, sys, mysql.connector

# O comando SQL para criar a tabela Tasks
CREATE_TABLE_SQL = """
CREATE TABLE IF NOT EXISTS Tasks (
    task_id VARCHAR(36) PRIMARY KEY,
    content TEXT NOT NULL,
    status VARCHAR(10) NOT NULL DEFAULT 'PENDING',
    priority VARCHAR(10) NOT NULL DEFAULT 'MEDIUM',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
"""

# FunÃ§Ã£o que executa o setup DDL
def setup_database():
    try:
        conn = mysql.connector.connect(
            host=os.environ.get("DB_HOST"),
            user=os.environ.get("DB_USER"),
            password=os.environ.get("DB_PASS"),
            database=os.environ.get("DB_NAME"),
            port=int(os.environ.get("DB_PORT")),
            ssl_mode="REQUIRED"
        )
        cursor = conn.cursor()
        cursor.execute(CREATE_TABLE_SQL)
        conn.commit()
        print("âœ… SUCESSO! Tabela 'Tasks' criada ou jÃ¡ existente.")
    except mysql.connector.Error as err:
        print(f"ðŸ›‘ ERRO AO CONFIGURAR O BANCO DE DADOS: {err}")
        sys.exit(1)

if __name__ == "__main__":
    setup_database()
